<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ & è¨ºç™‚å±¥æ­´ç®¡ç†</title>
    <style>
        /* ç°¡å˜ãªã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š */
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: auto; }
        label { display: block; margin-top: 10px; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; }
        button { margin-top: 20px; padding: 10px; width: 100%; }
    </style>
</head>
<body>
    <header>
        <h1>äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ & è¨ºç™‚å±¥æ­´ç®¡ç†</h1>

    </header>
    <div class="container">
        <h1>äºˆç´„ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</h1>
        <h2>ğŸ”³äºˆç´„çŠ¶æ³ğŸ”³</h2>
        
        <form id="reservationForm">
            <label for="datetime">æ—¥æ™‚:</label>
            <input type="datetime-local" id="datetime" required>

            <label for="hospitalName">ç—…é™¢å:</label>


            <label for="doctor">å…ˆç”Ÿ:</label>
            <input type="text" id="doctor" required>

            <label for="department">è¨ºç™‚ç§‘:</label>
            <input type="text" id="department" required>

            <label for="medication">ãŠè–¬:</label>
            <input type="text" id="medication">

            <label for="stuff">æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•:</label>
            <input type="text" id="stuff" required>

            <label for="notes">ãã®ä»–ãƒ¡ãƒ¢:</label>
            <textarea id="notes"></textarea>

            <button type="submit">äºˆç´„ã‚’ä¿å­˜</button>
        </form>

        <h2>ğŸ”³äºˆç´„ä¸€è¦§ğŸ”³</h2>
        <ul id="reservationList"></ul>

        <h1>è¨ºç™‚å±¥æ­´ç®¡ç†</h1>
        <h2>ğŸ”³è¨ºç™‚å±¥æ­´ğŸ”³</h2>
        <form id="historyForm">
            <label for="historyDate">è¨ºç™‚æ—¥:</label>
            <input type="date" id="historyDate" required>

            <label for="historyHospitalName">ç—…é™¢å:</label>
            <input type="text" id="historyHospitalName" required>

            <label for="historyDoctor">å…ˆç”Ÿ:</label>
            <input type="text" id="historyDoctor" required>

            <label for="historyDepartment">è¨ºç™‚ç§‘:</label>
            <input type="text" id="historyDepartment">

            <label for="historyMedication">å‡¦æ–¹è–¬:</label>
            <input type="text" id="historyMedication">

            <label for="historyStuff">æ‹…å½“ã‚¹ã‚¿ãƒƒãƒ•:</label>
            <input type="text" id="historyStuff" required>

            <label for="historyNotes">è¨ºç™‚å†…å®¹ãƒ»ãƒ¡ãƒ¢:</label>
            <textarea id="historyNotes"></textarea>

            <button type="submit">è¨ºç™‚å±¥æ­´ã‚’ä¿å­˜</button>
        </form>

        <h2>ğŸ”³è¨ºç™‚å±¥æ­´ä¸€è¦§ğŸ”³</h2>
        <ul id="historyList"></ul>
    </div>
    
<script>
$(document).ready(function() {
    const $form = $('#reservationForm');
    const $reservationList = $('#reservationList');
    const $historyForm = $('#historyForm');
    const $historyList = $('#historyList');

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«äºˆç´„ä¸€è¦§ã¨è¨ºç™‚å±¥æ­´ä¸€è¦§ã‚’è¡¨ç¤º
    displayReservations();
    displayHistory();

    // äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
    $form.on('submit', function(event) {
        event.preventDefault();

        const reservation = {
            datetime: $('#datetime').val(),
            hospitalName: $('#hospitalName').val(),
            doctor: $('#doctor').val(),
            department: $('#department').val(),
            medication: $('#medication').val(),
            notes: $('#notes').val()
        };

        saveReservation(reservation);
        displayReservations();
        $form[0].reset();
    });

    // è¨ºç™‚å±¥æ­´ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
    $historyForm.on('submit', function(event) {
        event.preventDefault();

        const history = {
            date: $('#historyDate').val(),
            hospitalName: $('#historyHospitalName').val(),
            doctor: $('#historyDoctor').val(),
            department: $('#historyDepartment').val(),
            medication: $('#historyMedication').val(),
            notes: $('#historyNotes').val()
        };

        saveHistory(history);
        displayHistory();
        $historyForm[0].reset();
    });

    // äºˆç´„ã‚’Local Storageã«ä¿å­˜
    function saveReservation(reservation) {
        let reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        reservations.push(reservation);
        localStorage.setItem('reservations', JSON.stringify(reservations));
    }

    // è¨ºç™‚å±¥æ­´ã‚’Local Storageã«ä¿å­˜
    function saveHistory(history) {
        let histories = JSON.parse(localStorage.getItem('histories')) || [];
        histories.push(history);
        localStorage.setItem('histories', JSON.stringify(histories));
    }

    // äºˆç´„ä¸€è¦§ã‚’è¡¨ç¤º
    function displayReservations() {
        $reservationList.empty();
        let reservations = JSON.parse(localStorage.getItem('reservations')) || [];

        $.each(reservations, function(index, reservation) {
            const $li = $('<li>').text(`${reservation.datetime} - ${reservation.hospitalName} (${reservation.department}, ${reservation.doctor})`);
            $reservationList.append($li);

            // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½
            checkReminder(reservation);
        });
    }

    // è¨ºç™‚å±¥æ­´ä¸€è¦§ã‚’è¡¨ç¤º
    function displayHistory() {
        $historyList.empty();
        let histories = JSON.parse(localStorage.getItem('histories')) || [];

        $.each(histories, function(index, history) {
            const $li = $('<li>').text(`${history.date} - ${history.hospitalName} (${history.department}, ${history.doctor}) - å‡¦æ–¹è–¬: ${history.medication}`);
            $li.append($('<p>').text(`è¨ºç™‚å†…å®¹: ${history.notes}`));
            $historyList.append($li);
        });
    }

    // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½: ç¾åœ¨ã®æ™‚é–“ã¨äºˆç´„æ™‚é–“ã‚’æ¯”è¼ƒ
    function checkReminder(reservation) {
        const now = new Date();
        const reservationTime = new Date(reservation.datetime);

        // äºˆç´„æ™‚é–“ãŒè¿‘ã¥ã„ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤ºï¼ˆä¾‹: 24æ™‚é–“å‰ï¼‰
        if (reservationTime > now && reservationTime - now <= 86400000) {
            alert(`é–“ã‚‚ãªãäºˆç´„ãŒã‚ã‚Šã¾ã™: ${reservation.hospitalName} (${reservation.department}, ${reservation.doctor})`);
        }
    }

    // è¨ºç™‚ç§‘åˆ¥ã®åŒ»å¸«æ¨å¥¨
    $('#department').on('change', function() {
        const selectedDepartment = $(this).val();
        const histories = JSON.parse(localStorage.getItem('histories')) || [];
        const relatedDoctors = histories.filter(history => history.department === selectedDepartment).map(history => history.doctor);

        if (relatedDoctors.length > 0) {
            alert(`ã“ã®è¨ºç™‚ç§‘ã§ä»¥å‰ã«å—è¨ºã—ãŸå…ˆç”Ÿ: ${relatedDoctors.join(', ')}`);
        }
    });
});
   
</script>

</body>
</html>